### **大白话版本**的微服务笔记

匹配玩家的过程是一个异步的过程

而http请求很难达到这种效果。

因为一般的http请求，是**立即响应**。即client发送一个请求，server接收到后尽可能快响应。这个过程可以看作是你问我答的过程。因此，这个过程经历的时间很短。

而匹配系统的实现，则是发送一个请求，但是我们不知道返回结果需要花多少时间。而且也不知道服务器会返回给我们多少个结果。

因此，就需要用到Websocket协议。

Websocket的好处。不仅客户端可以主动得向服务器发送请求，服务器也可以主动的向客户端发送请求。全双工**通信**





程序的逻辑：

当我们打开客户端并点击“开始匹配”的时候，会向服务器发送一个请求。当服务器接收到请求之后，会把这个请求发送到匹配系统（一个单独的程序）。当匹配到一组用户的时候，匹配系统会将匹配到的用户返回给服务器。服务器再将匹配信息返回给当前对战的每一名玩家。

![image-20230317144838236](C:\Users\18795\AppData\Roaming\Typora\typora-user-images\image-20230317144838236.png)

而这个**独立的匹配系统**，就是微服务。通过SpringCloud来实现。



> Q: 两名玩家的地图会不一样？怎么解决这个问题 ？ 
>
> A: 生成的过程要放到云端服务器里。同时，像判断输、赢的逻辑也需要在云端服务器里执行。这是因为，如果逻辑的判断在客户端执行的话，用户很容易进行作弊。所以，整个游戏的逻辑，都需要放到服务器端。注意，并不是所有游戏都像kob一样放在云端的。有些射击类游戏，由于本地操作的频繁，在服务器进行判定的话会导致延迟高的问题。因此对于这些游戏的逻辑判断都放在本地了。但是，这也增加了作弊情况的发生。



> Q: 那么在云端的流程是什么呢？
>
> A: 流程如下
>
> 1. 服务器生成地图，将地图传给两个客户端(玩家1，玩家2）
>
>   	 2. 传完之后，等待用户的输入。
>        * waiting  思路：写个死循环。设定时间sleep，有操作，下一步，没操作，接着等。超时判输赢。
>        * 有操作，写一个judging，判断操作是否合法，比如撞墙。
>   	 3. 用户的输入可以有两种形式： 
>        1. bot代码的形式 （微服务）
>           微服务大白话就是“一个额外的程序”。比如mysql可以帮我们把数据存在硬盘的文件一样。
>        2. 上下左右键



> Q: Websocket的基本原理是什么？
>
> A：前端建立的每一个Websocket的连接都会在后端维护起来。
>
> ​	WebsocketServer 类。每来一个(创建一个）连接，就是new一个这个类的实例。
>
> Q: 涉及到多线程和并发吗？
>
>    WebsocketServer就是多线程，每来一个连接，都会开一个新的线程来维护。



AI写法， min max （alpha减阵搜索）




![image-20230317151557793](C:\Users\18795\AppData\Roaming\Typora\typora-user-images\image-20230317151557793.png)

以上内容不涉及微服务。